<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tutor Test Client</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; padding: 0 1rem; }
        #chat-box { border: 1px solid #ccc; height: 400px; overflow-y: scroll; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; }
        .message { margin-bottom: 0.5rem; padding: 0.5rem; border-radius: 4px; }
        .user { background-color: #e3f2fd; text-align: right; margin-left: 20%; }
        .bot { background-color: #f5f5f5; margin-right: 20%; }
        .status { font-style: italic; color: #666; font-size: 0.9rem; height: 1.5rem; }
        #input-area { display: flex; gap: 0.5rem; }
        input { flex-grow: 1; padding: 0.5rem; }
        button { padding: 0.5rem 1rem; cursor: pointer; }
    </style>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <h1>AI Tutor Chat</h1>
    <div id="status-indicator" class="status">Connecting...</div>
    <div id="chat-box"></div>
    <div id="input-area">
        <input type="text" id="message-input" placeholder="Type a message..." autocomplete="off">
        <button onclick="sendMessage()">Send</button>
    </div>

    <script>
        const socket = io();
        const chatBox = document.getElementById('chat-box');
        const statusInd = document.getElementById('status-indicator');
        const input = document.getElementById('message-input');

        function appendMessage(text, sender) {
            const div = document.createElement('div');
            div.classList.add('message', sender);
            div.textContent = text;
            chatBox.appendChild(div);
            // Auto scroll
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        socket.on('connect', () => {
            statusInd.textContent = "Connected";
            statusInd.style.color = "green";
        });

        socket.on('disconnect', () => {
            statusInd.textContent = "Disconnected";
            statusInd.style.color = "red";
        });

        socket.on('chat:response', (msg) => {
            appendMessage(msg, 'bot');
        });

        socket.on('status', (state) => {
            if (state === 'thinking') {
                statusInd.textContent = "Tutor is thinking...";
            } else {
                statusInd.textContent = "Connected";
            }
        });

        socket.on('error', (err) => {
            alert("Error: " + err);
        });

        function sendMessage() {
            const text = input.value.trim();
            if (text) {
                appendMessage(text, 'user');
                socket.emit('chat:message', text);
                input.value = '';
            }
        }

        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    </script>
</body>
</html>
